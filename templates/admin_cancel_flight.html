<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Cancel Flight | FlyTAU</title>
    <link rel="stylesheet" href="/static/admin_cancel_flight.css">
    <link href='https://cdn.boxicons.com/3.0.6/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
<header class="top-bar">
  <a href="/" class="logo-link">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="Company Logo" class="company-logo">
  </a>
  <a href="/admin/flights" class="back-home">
    <i class='bx bx-arrow-left'></i>
    Back to flights
  </a>
</header>

<div class="wrapper">

  <h1>Cancel Flight</h1>

  {% if error %}
    <div class="warn">{{ error }}</div>
  {% endif %}

  {% set st = (derived_status if derived_status is defined else (flight.status|string)|lower) %}
{% set can_cancel = (can_cancel if can_cancel is defined else (st == 'open')) %}


{% set status_label =
  'Active' if st == 'open'
  else 'Full' if st == 'full'
  else 'Completed' if st == 'done'
  else 'Cancelled' if st == 'cancelled'
  else st
%}


{% if not can_cancel %}
  <div class="info">
    This flight is currently <b>{{ status_label }}</b>.
    Only flights with status <b>פעילה</b> can be cancelled.
  </div>
{% endif %}


  <div class="box">
    <div class="row">
      <span class="pill">Flight ID: <b>{{ flight.flight_id }}</b></span>
      <span class="pill">Date: <b>{{ flight.departure_date }}</b></span>
      <span class="pill">Time: <b>{{ flight.departure_time }}</b></span>
      <span class="pill">
        Status:
        <span class="status
          {% if st=='open' %}status-open{% elif st=='cancelled' %}status-cancelled{% elif st=='full' %}status-full{% elif st=='done' %}status-done{% endif %}
        ">
          {{ status_label }}
        </span>
      </span>
    </div>

    <p class="muted" style="margin-top: 10px;">
      This action will mark the flight as <b>cancelled</b>. Customers’ active/paid orders will be <b>system-cancelled</b> and seats released.
    </p>

    <p class="warn" style="margin-top: 8px;">
      Policy: If the flight is less than <b>72 hours</b> from departure, cancellation is blocked.
    </p>
  </div>

  <div class="box">
    <h3>Confirm cancellation</h3>
    <p class="muted">Please confirm you want to cancel this flight.</p>

    <form method="POST">
      <button type="submit" {% if not can_cancel %}disabled{% endif %}>
        Confirm
      </button>

      {% if not can_cancel %}
        <p class="muted" style="margin-top:10px;">
          To cancel, change the flight status back to <b>open</b> and try again.
        </p>
      {% endif %}
    </form>
  </div>

</div>
</body>
</html>
